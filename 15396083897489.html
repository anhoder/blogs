<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  NginxæœåŠ¡å™¨é…ç½®è¯¦è§£ - Alançš„è¿›é˜¶æ—¥å¿—
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Alançš„è¿›é˜¶æ—¥å¿—" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
 
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:alanalbert.github.io ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">åšå®¢</a></li>
        
        <li id=""><a target="_self" href="archives.html">å½’æ¡£</a></li>
        
        <li id=""><a target="_self" href="about.html">å…³äº</a></li>
        
        <li id=""><a target="_blank" href="https://github.com/AlanAlbert">GitHub</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Alançš„è¿›é˜¶æ—¥å¿—</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">åšå®¢</a></li>
        
        <li><a target="_self" href="archives.html">å½’æ¡£</a></li>
        
        <li><a target="_self" href="about.html">å…³äº</a></li>
        
        <li><a target="_blank" href="https://github.com/AlanAlbert">GitHub</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="php.html">PHP</a></li>
        
            <li><a href="interview.html">é¢è¯•</a></li>
        
            <li><a href="security.html">å®‰å…¨</a></li>
        
            <li><a href="linux.html">Linux</a></li>
        
            <li><a href="mysql.html">MySQL</a></li>
        
            <li><a href="redis.html">Redis</a></li>
        
            <li><a href="data-struct-and-algorithm.html">æ•°æ®ç»“æ„åŠç®—æ³•</a></li>
        
            <li><a href="computer-network.html">è®¡ç®—æœºç½‘ç»œ</a></li>
        
            <li><a href="version-control-tool.html">ç‰ˆæœ¬æ§åˆ¶å·¥å…·</a></li>
        
            <li><a href="read.html">è¯»ä¹¦</a></li>
        
            <li><a href="javascript.html">JavaScript</a></li>
        
            <li><a href="web-server.html">WebæœåŠ¡å™¨</a></li>
        
            <li><a href="hackintosh.html">é»‘è‹¹æœ</a></li>
        
            <li><a href="markdown.html">Markdown</a></li>
        
            <li><a href="other.html">å…¶å®ƒ</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
              <div class="f-img"><img src="https://source.unsplash.com/random/1024x398" /></div>
          
          <h1>NginxæœåŠ¡å™¨é…ç½®è¯¦è§£</h1>
     
        <div class="read-more clearfix">
          <span class="date">2018/10/15</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='nginx.html'>Nginx</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <span id="more"></span><!-- more -->

<p><em>Mission Start!</em></p>

<p>Nginxçš„é…ç½®ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p>

<pre><code class="language-conf">events {
  use epoll;
}

http {
  #http
  server {
    listen 80;
    ...
    
    location / {
        if() {
          ...
        }
    }
    ...
  }
  
  #https
  server {
    listen 443;
    ...
  }
  
  ...
}
</code></pre>

<h2 id="toc_0">ä¸€ã€locationè§„åˆ™</h2>

<p>æ ¼å¼å¦‚ä¸‹ï¼š    </p>

<pre><code class="language-conf">location [ = | ^~ | ~ | ~* | / ] [å­—ç¬¦ä¸² | æ­£åˆ™è¡¨è¾¾å¼] {
    [ç›¸å…³å¤„ç†]
}
</code></pre>

<ul>
<li>â‘  = è¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼Œä¾‹å¦‚ï¼šlocation = / {...}è¡¨ç¤ºåªåŒ¹é…æ ¹ç›®å½•çš„è¯·æ±‚ï¼ŒååŠ å­—ç¬¦ä¸²çš„ä¸èƒ½åŒ¹é…</li>
<li>â‘¡ <sup>~</sup> è¡¨ç¤ºåŒ¹é…URIä»¥å¸¸è§„å­—ç¬¦ä¸²å¼€å¤´çš„è¯·æ±‚ï¼Œä¸æ˜¯æ­£åˆ™åŒ¹é…ï¼Œä¾‹å¦‚ï¼šlocation <sup>~</sup> /home {...}åªèƒ½åŒ¹é…/home/indexã€/home/other/otherç­‰ä»¥å…¶å¼€å¤´çš„è¯·æ±‚</li>
<li>â‘¢ ~ è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</li>
<li>â‘£ ~* è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</li>
<li>â‘¤ / è¡¨ç¤ºé€šç”¨åŒ¹é…ï¼Œä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…</li>
</ul>

<p>ä¼˜å…ˆçº§ï¼š(location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location <sup>~)</sup> &gt; (location ~,~*) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) &gt; (location /)</p>

<h2 id="toc_1">äºŒã€rewriteè§„åˆ™</h2>

<p>ä½œç”¨ï¼šä½¿ç”¨nginxçš„å…¨å±€å˜é‡åŠè‡ªå®šä¹‰å˜é‡å®ç°URLçš„é‡å†™åŠé‡å®šå‘ï¼ˆæ”¾åœ¨serverã€locationã€ifä¸­ï¼‰ã€‚   </p>

<p>rewriteå’Œlocationå…·æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œå…¶åŒºåˆ«åœ¨äºï¼š</p>

<blockquote>
<p>locationä¸»è¦ç”¨äºè®¿é—®æ§åˆ¶ã€åå‘ä»£ç†<br/><br/>
rewriteä¸»è¦ç”¨äºå®ç°URLçš„é‡å†™ã€è·³è½¬</p>
</blockquote>

<p>rewriteè§„åˆ™æ ¼å¼å¦‚ä¸‹ï¼š</p>

<pre><code class="language-conf">rewrite æ­£åˆ™è¡¨è¾¾å¼ ç›®æ ‡URL æ ‡å¿—ä½;
</code></pre>

<p>ä¾‹å¦‚ï¼š</p>

<pre><code class="language-conf">server {
  rewrite /(.*)$ /index.php/$1 last; # éšè—URLä¸­çš„index.php

  location ~ (.*)/index\.php$ {
    ...
  }
}
# http://www.xxxx.com/home/controller/action/paramè¯·æ±‚åˆ°æ¥
# â‘  serverä¸­çš„rewriteåŒ¹é…åˆ°è¯¥è¯·æ±‚ï¼Œå¹¶å°†URLé‡å†™ä¸ºhttp://www.xxxx.com/index.php/home/controller/action/param
# â‘¡ locationåŒ¹é…åˆ°é‡å†™åçš„URLï¼ˆhttp://www.xxxx.com/index.php/home/controller/action/paramï¼‰ï¼Œæ‰§è¡Œlocationä¸­çš„æ“ä½œ
</code></pre>

<h3 id="toc_2">1ã€æ ‡å¿—ä½</h3>

<ul>
<li>â‘  last è¡¨ç¤ºå®Œæˆrewrite</li>
<li>â‘¡ break è¡¨ç¤ºåœæ­¢å½“å‰è™šæ‹Ÿä¸»æœºçš„åç»­rewriteæŒ‡ä»¤</li>
<li>â‘¢ redirect è¡¨ç¤ºè¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€</li>
<li>â‘£ permanent è¡¨ç¤ºè¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ æ˜¾ç¤ºè·³è½¬åçš„åœ°å€</li>
</ul>

<h3 id="toc_3">2ã€ifæŒ‡ä»¤</h3>

<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>

<pre><code class="language-conf">if(condition) {
  ...
}
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>

<ul>
<li>â‘  åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ä½¿ç”¨ = æˆ– !=</li>
<li>â‘¡ ~ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œ~* ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œ!~ åŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…</li>
<li>â‘¢ -f å’Œ !-f ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶</li>
<li>â‘£ -d å’Œ !-d ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®å½•</li>
<li>â‘¤ -e å’Œ !-e ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–ç›®å½•</li>
<li>â‘¥ -x å’Œ !-x ç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ</li>
</ul>

<p>ifä½¿ç”¨ç”¨ä¾‹ï¼š</p>

<pre><code class="language-conf">if ($http_user_agent ~ MSIE) {
    ...
}
</code></pre>

<h3 id="toc_4">3ã€Nginxå…¨å±€å˜é‡</h3>

<ul>
<li>\(argsï¼šè¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ\)query_string</li>
<li>$content_lengthï¼šè¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚</li>
<li>$content_typeï¼šè¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚</li>
<li>$document_rootï¼šå½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚</li>
<li>$hostï¼šè¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚</li>
<li>$http_user_agentï¼šå®¢æˆ·ç«¯agentä¿¡æ¯</li>
<li>$http_cookieï¼šå®¢æˆ·ç«¯cookieä¿¡æ¯</li>
<li>$limit_rateï¼šè¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚</li>
<li>$request_methodï¼šå®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚</li>
<li>$remote_addrï¼šå®¢æˆ·ç«¯çš„IPåœ°å€ã€‚</li>
<li>$remote_portï¼šå®¢æˆ·ç«¯çš„ç«¯å£ã€‚</li>
<li>$remote_userï¼šå·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚</li>
<li>$request_filenameï¼šå½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚</li>
<li>$schemeï¼šHTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚</li>
<li>$server_protocolï¼šè¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚</li>
<li>$server_addrï¼šæœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚</li>
<li>$server_nameï¼šæœåŠ¡å™¨åç§°ã€‚</li>
<li>$server_portï¼šè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚</li>
<li>$request_uriï¼šåŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€/foo/bar.php?arg=bazâ€ã€‚</li>
<li>\(uriï¼šä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ\)uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚</li>
<li>\(document_uriï¼šä¸\)uriç›¸åŒã€‚</li>
</ul>

<h2 id="toc_5">ä¸‰ã€upstreamæ¨¡å—ä¸è´Ÿè½½å‡è¡¡</h2>

<p>Nginxçš„åå‘ä»£ç†æ˜¯å…¶å‡ºè‰²çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œé€šè¿‡åå‘ä»£ç†å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚è€ŒupstreamèŠ‚ç‚¹å°±æ˜¯é…ç½®åå‘ä»£ç†çš„å…³é”®æ‰€åœ¨ã€‚   </p>

<h3 id="toc_6">é…ç½®æ­¥éª¤</h3>

<p>â‘  åœ¨httpèŠ‚ç‚¹ä¸‹åŠ å…¥upstreamèŠ‚ç‚¹ï¼š</p>

<pre><code class="language-conf">upstream upstreamName {
    server ip1:port1;
    server ip2:port2;
    ...
}
</code></pre>

<p>â‘¡ åœ¨serverèŠ‚ç‚¹ä¸‹çš„locationèŠ‚ç‚¹ä¸­ï¼Œå°†ç›¸åº”çš„è¯·æ±‚é€šè¿‡proxy_passè½¬å‘åˆ°http://upstreamNameä¸‹ï¼š</p>

<pre><code class="language-conf">location / {
    ...
    proxy_pass http://upstreamName;
    ...
}
</code></pre>

<p>è‡³æ­¤ï¼Œè´Ÿè½½å‡è¡¡å·²ç»é…ç½®å®Œæ¯•ï¼ŒNginxä¼šæ ¹æ®è½®è¯¢çš„ç­–ç•¥å°†è¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ä¸Šã€‚   </p>

<p>å½“ç„¶ï¼Œè¿˜å­˜åœ¨å…¶ä»–çš„åˆ†é…ç­–ç•¥ã€‚</p>

<h3 id="toc_7">è¯·æ±‚åˆ†é…ç­–ç•¥</h3>

<h4 id="toc_8">â‘  è½®è¯¢</h4>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä½¿ç”¨è½®è¯¢çš„æ–¹å¼è¿›è¡Œè¯·æ±‚çš„åˆ†é…ï¼Œè¿™ç§æ–¹å¼è™½ç„¶é…ç½®ç®€å•ï¼Œä½†ç¼ºç‚¹åœ¨äºå¯é æ€§ä¸é«˜ã€è¯·æ±‚åˆ†å‘ä¸å‡è¡¡ã€‚   </p>

<h4 id="toc_9">â‘¡ weightæƒé‡</h4>

<p>åœ¨upstreamèŠ‚ç‚¹ä¸­æŒ‡å®šserverçš„weightæƒé‡ï¼ŒNginxä¼šæ ¹æ®æ¯ä¸ªæœåŠ¡å™¨çš„æƒé‡è°ƒæ•´åˆ†å‘è¯·æ±‚çš„å‡ ç‡ï¼Œweightä¸åˆ†å‘è¯·æ±‚çš„å‡ ç‡æˆæ­£æ¯”ï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-conf">upstream upstreamName{
    server ip1:port1 weight=1;
    server ip2:port2 weight=2;
    # è½¬å‘è¯·æ±‚ç»™ip2æœåŠ¡å™¨çš„å‡ ç‡æ˜¯è½¬å‘ç»™ip1æœåŠ¡å™¨çš„ä¸¤å€
    ...
}
</code></pre>

<h4 id="toc_10">â‘¢ ip_hash</h4>

<p>æ¯ä¸ªè¯·æ±‚éƒ½æŒ‰ç…§è®¿é—®ipçš„hashç»“æœè¿›è¡Œåˆ†é…ï¼Œå³è®¿é—®ipä¸æœåŠ¡å™¨ç»‘å®šï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚éƒ½ä¼šå›ºå®šè½¬å‘åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šè¿›è¡Œå¤„ç†ï¼ˆè¯¥æ–¹æ³•å¯ä»¥ç”¨äºè§£å†³åˆ†å¸ƒå¼sessionä¸ä¸€è‡´çš„é—®é¢˜ï¼‰ã€‚ä½¿ç”¨æ–¹æ³•ï¼š</p>

<pre><code class="language-conf">upstream upstreamName{
    ip_hash;
    server ip1:port1;
    server ip2:port2;
    ...
}
</code></pre>

<h4 id="toc_11">â‘£ fair</h4>

<p>ä½¿ç”¨åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´ä½œä¸ºä¾æ®ï¼Œå“åº”æ—¶é—´çŸ­çš„æœåŠ¡å™¨åˆ†é…åˆ°æ›´å¤šçš„è¯·æ±‚ã€‚</p>

<pre><code class="language-conf">upstream upstreamName{
    fair;
    server ip1:port1;
    server ip2:port2;
}
</code></pre>

<h3 id="toc_12">â‘¤ url_hash</h3>

<p>é€šè¿‡è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œè®©urlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼š</p>

<pre><code class="language-conf">upstream upstreamName{
    server ip1:port1;
    server ip2:port2;
    hash $request_uri;  
    hash_method crc32;  # è®¡ç®—hashæ—¶ä½¿ç”¨çš„hashç®—æ³•
    ### ä½¿ç”¨hashåï¼Œä¸èƒ½ä½¿ç”¨weightç­‰å…¶ä»–å‚æ•°
}
</code></pre>

<h3 id="toc_13">çŠ¶æ€å€¼</h3>

<p>upstreamèŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªè®¾å¤‡è®¾ç½®çŠ¶æ€å€¼ï¼Œå¦‚ä¸‹ï¼š</p>

<blockquote>
<p>down: è¡¨ç¤ºå½“å‰çš„serverä¸å‚ä¸è´Ÿè½½å‡è¡¡<br/><br/>
weight: weightè¶Šå¤§ï¼Œæ”¶åˆ°çš„è¯·æ±‚å°±è¶Šå¤š<br/><br/>
max_fails: å…è®¸è¯·æ±‚å¤±è´¥çš„æœ€å¤§æ¬¡æ•°ï¼Œå½“è¶…è¿‡è¯¥å€¼æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯<br/><br/>
fail_timeout: è¾¾åˆ°max_failsæ¬¡å¤±è´¥æ—¶ï¼Œæš‚åœçš„æ—¶é—´<br/><br/>
backup: åå¤‡æœåŠ¡å™¨ï¼Œå½“å…¶ä»–å…¨éƒ¨çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨   </p>
</blockquote>

<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>

<pre><code class="language-conf">upstream upstreamName{
    server ip1:port1 down;
    server ip2:port2 weight=2;
    server ip3:port3 backup;
}
</code></pre>

<h3 id="toc_14">åˆ†å¸ƒå¼ç³»ç»Ÿsessionçš„å¤„ç†æ–¹æ³•</h3>

<p>â‘  sessionå¤åˆ¶ï¼šå½“æŸä¸€å°æœåŠ¡å™¨çš„sessionå‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°†sessionçš„æ”¹å˜å¤åˆ¶åˆ°å…¶ä»–æ‰€æœ‰æœåŠ¡å™¨ä¸Šï¼ˆæ¯«æ— ç–‘é—®ï¼Œè¯¥æ–¹æ³•çš„æ€§èƒ½è¾ƒä½ï¼‰<br/><br/>
â‘¡ è¯·æ±‚ipä¸æœåŠ¡å™¨ç»‘å®šï¼šå®¢æˆ·ç«¯çš„ipä¸æœåŠ¡å™¨ç»‘å®šåœ¨ä¸€èµ·ï¼ŒåŒä¸€ç”¨æˆ·çš„è¯·æ±‚éƒ½è½¬å‘åˆ°åŒä¸€å°æœºå™¨ä¸Šè¿›è¡Œå¤„ç†<br/><br/>
â‘¢ å°†sessionä¿¡æ¯å­˜æ”¾åœ¨MySQLç­‰æ•°æ®åº“ä¸­<br/><br/>
â‘£ å°†sessionå­˜æ”¾åœ¨Redisã€memcachedå†…å­˜æ•°æ®åº“ä¸­</p>

<h2 id="toc_15">å››ã€Eventsäº‹ä»¶æ¨¡å‹ã€é˜»å¡/éé˜»å¡å’ŒåŒæ­¥/å¼‚æ­¥</h2>

<p>Nginxçš„I/Oæ¨¡å‹åŒ…æ‹¬æ ‡å‡†äº‹ä»¶æ¨¡å‹ã€é«˜æ•ˆäº‹ä»¶æ¨¡å‹ã€‚</p>

<h3 id="toc_16">é˜»å¡/éé˜»å¡ä¸åŒæ­¥/å¼‚æ­¥</h3>

<p>æˆ‘ç›¸ä¿¡æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†äººä¼šæŠŠéé˜»å¡I/Oå’Œå¼‚æ­¥I/Oæ··ä¸ºä¸€è°ˆï¼Œå› ä¸ºæˆ‘åœ¨å†™è¿™ç¯‡åšå®¢ä¹‹å‰ä¹Ÿæ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚</p>

<h4 id="toc_17">é˜»å¡I/Oã€éé˜»å¡I/O</h4>

<blockquote>
<p>é˜»å¡I/Oï¼šåº”ç”¨ç¨‹åºéœ€è¦ç­‰å¾…I/Oå®Œæˆåæ‰è¿”å›ç»“æœï¼Œé˜»å¡I/Oé€ æˆCPUç­‰å¾…I/Oï¼ŒCPUçš„èƒ½åŠ›ä¸èƒ½å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚<br/><br/>
éé˜»å¡I/Oï¼šåœ¨è°ƒç”¨åç›´æ¥è¿”å›ï¼Œä¸ç­‰å¾…I/Oå®Œæˆï¼Œä½†ä¹‹åéœ€è¦ä½¿ç”¨è½®è¯¢æˆ–è€…å…¶ä»–äº‹ä»¶æ¨¡å‹ï¼ˆselectã€pollã€epollã€kqueueï¼‰æ¥åˆ¤æ–­æ˜¯å¦å®ŒæˆI/Oï¼Œè‹¥I/Oå®Œæˆï¼Œåˆ™æ‰§è¡Œåç»­æ“ä½œã€‚<br/><br/>
åœ¨éé˜»å¡I/Oè¿”å›åï¼ŒCPUçš„æ—¶é—´ç‰‡å¯ä»¥ç”¨æ¥å¤„ç†å…¶ä»–äº‹åŠ¡ã€‚   </p>
</blockquote>

<h4 id="toc_18">åŒæ­¥I/Oã€å¼‚æ­¥I/O</h4>

<blockquote>
<p>åŒæ­¥I/Oï¼šå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°I/Oæ“ä½œå®Œæˆï¼›<br/><br/>
å¼‚æ­¥I/Oï¼šä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼ŒI/Oå®Œæˆå‘å‡ºé€šçŸ¥</p>
</blockquote>

<h4 id="toc_19">å…³ç³»</h4>

<p>é˜»å¡I/Oã€éé˜»å¡I/Oéƒ½å±äºåŒæ­¥I/Oï¼Œç”¨çŸ¥ä¹çš„ä¸€ä¸ªå›ç­”æ¥è¯´æ˜å§ï¼š</p>

<blockquote>
<p><em>ä½œè€…ï¼šæ„šæŠ„</em><br/><br/>
<em>é“¾æ¥ï¼š<a href="https://www.zhihu.com/question/19732473/answer/23434554">https://www.zhihu.com/question/19732473/answer/23434554</a></em><br/><br/>
<em>æ¥æºï¼šçŸ¥ä¹</em>   </p>

<p>è€å¼ çˆ±å–èŒ¶ï¼ŒåºŸè¯ä¸è¯´ï¼Œç…®å¼€æ°´ã€‚<br/><br/>
å‡ºåœºäººç‰©ï¼šè€å¼ ï¼Œæ°´å£¶ä¸¤æŠŠï¼ˆæ™®é€šæ°´å£¶ï¼Œç®€ç§°æ°´å£¶ï¼›ä¼šå“çš„æ°´å£¶ï¼Œç®€ç§°å“æ°´å£¶ï¼‰ã€‚   </p>

<p>1 è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆåŒæ­¥é˜»å¡ï¼‰<br/><br/>
è€å¼ è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚»<br/><br/>
2 è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ—¶ä¸æ—¶å»å¨æˆ¿çœ‹çœ‹æ°´å¼€æ²¡æœ‰ã€‚ï¼ˆåŒæ­¥éé˜»å¡ï¼‰<br/><br/>
è€å¼ è¿˜æ˜¯è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚»ï¼Œäºæ˜¯å˜é«˜ç«¯äº†ï¼Œä¹°äº†æŠŠä¼šå“ç¬›çš„é‚£ç§æ°´å£¶ã€‚æ°´å¼€ä¹‹åï¼Œèƒ½å¤§å£°å‘å‡ºå˜€~~~~çš„å™ªéŸ³ã€‚<br/><br/>
3 è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰<br/><br/>
è€å¼ è§‰å¾—è¿™æ ·å‚»ç­‰æ„ä¹‰ä¸å¤§<br/><br/>
4 è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ°´å£¶å“ä¹‹å‰ä¸å†å»çœ‹å®ƒäº†ï¼Œå“äº†å†å»æ‹¿å£¶ã€‚ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰<br/><br/>
è€å¼ è§‰å¾—è‡ªå·±èªæ˜äº†ã€‚   </p>

<p>æ‰€è°“åŒæ­¥å¼‚æ­¥ï¼Œåªæ˜¯å¯¹äºæ°´å£¶è€Œè¨€ã€‚<br/><br/>
æ™®é€šæ°´å£¶ï¼ŒåŒæ­¥ï¼›å“æ°´å£¶ï¼Œå¼‚æ­¥ã€‚<br/><br/>
è™½ç„¶éƒ½èƒ½å¹²æ´»ï¼Œä½†å“æ°´å£¶å¯ä»¥åœ¨è‡ªå·±å®Œå·¥ä¹‹åï¼Œæç¤ºè€å¼ æ°´å¼€äº†ã€‚è¿™æ˜¯æ™®é€šæ°´å£¶æ‰€ä¸èƒ½åŠçš„ã€‚åŒæ­¥åªèƒ½è®©è°ƒç”¨è€…å»è½®è¯¢è‡ªå·±ï¼ˆæƒ…å†µ2ä¸­ï¼‰ï¼Œé€ æˆè€å¼ æ•ˆç‡çš„ä½ä¸‹ã€‚   </p>

<p>æ‰€è°“é˜»å¡éé˜»å¡ï¼Œä»…ä»…å¯¹äºè€å¼ è€Œè¨€ã€‚<br/><br/>
ç«‹ç­‰çš„è€å¼ ï¼Œé˜»å¡ï¼›çœ‹ç”µè§†çš„è€å¼ ï¼Œéé˜»å¡ã€‚<br/><br/>
æƒ…å†µ1å’Œæƒ…å†µ3ä¸­è€å¼ å°±æ˜¯é˜»å¡çš„ï¼Œåª³å¦‡å–Šä»–éƒ½ä¸çŸ¥é“ã€‚è™½ç„¶3ä¸­å“æ°´å£¶æ˜¯å¼‚æ­¥çš„ï¼Œå¯å¯¹äºç«‹ç­‰çš„è€å¼ æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ã€‚æ‰€ä»¥ä¸€èˆ¬å¼‚æ­¥æ˜¯é…åˆéé˜»å¡ä½¿ç”¨çš„ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„æ•ˆç”¨ã€‚<br/><br/>
â€”â€”æ¥æºç½‘ç»œï¼Œä½œè€…ä¸æ˜ã€‚   </p>
</blockquote>

<h3 id="toc_20">æ ‡å‡†äº‹ä»¶æ¨¡å‹</h3>

<p>å¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´é«˜æ•ˆçš„æ–¹æ³•ï¼Œåˆ™ä½¿ç”¨æ ‡å‡†äº‹ä»¶æ¨¡å‹selectæˆ–poll</p>

<h4 id="toc_21">read</h4>

<p>readæ˜¯æœ€åŸå§‹ã€æœ€ä½æ•ˆçš„äº‹ä»¶æ¨¡å‹ã€‚å…¶é€šè¿‡é‡å¤è°ƒç”¨æ¥æ£€æŸ¥I/OçŠ¶æ€ï¼Œå³è½®è¯¢ã€‚</p>

<h4 id="toc_22">select</h4>

<p>selectæ˜¯readçš„æ”¹è¿›ç‰ˆï¼Œå®ƒé€šè¿‡è½®è¯¢ç›‘è§†æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ¥è·å–å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆé›†åˆä¸­çš„æ–‡ä»¶æè¿°ç¬¦ä¼šè¢«å†…æ ¸è¿›è¡Œæ ‡å¿—ä½ä¿®æ”¹ï¼‰ã€‚<br/><br/>
ç¼ºç‚¹ï¼šâ‘  æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å…·æœ‰é™åˆ¶ï¼›â‘¡ å½“æ–‡ä»¶æè¿°ç¬¦æ•°é‡å¢å¤šæ—¶ï¼Œé‡‡å–è½®è¯¢çš„æ€§èƒ½ä¼šé™ä½ï¼›</p>

<h4 id="toc_23">poll</h4>

<p>pollçš„å¤„ç†æœºåˆ¶ä¸selectç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºpollä½¿ç”¨é“¾è¡¨ï¼Œè€Œä¸æ˜¯æ•°ç»„ï¼Œé¿å…äº†é•¿åº¦é™åˆ¶ã€‚ä½†æ–‡ä»¶æè¿°ç¬¦è¾ƒå¤šæ—¶ï¼Œæ€§èƒ½è¿˜æ˜¯ååˆ†ä½ä¸‹ã€‚</p>

<h3 id="toc_24">é«˜æ•ˆäº‹ä»¶æ¨¡å‹</h3>

<h4 id="toc_25">Epoll</h4>

<p><em>ä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿ</em><br/><br/>
ç›¸å¯¹äºpollï¼Œepollåªä¼šå¤„ç†å‘ç”Ÿæ”¹å˜çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™æ ·é¿å…äº†ä¸å¿…è¦çš„äº‹ä»¶å¤„ç†ï¼Œæå‡äº†æ€§èƒ½åŠæ•ˆç‡ã€‚</p>

<h4 id="toc_26">Kqueue</h4>

<p><em>ä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X</em><br/><br/>
å®ç°æ–¹å¼ä¸epollç±»ä¼¼ï¼Œä¸è¿‡å®ƒä»…åœ¨FreeBSDç³»ç»Ÿä¸‹å­˜åœ¨ã€‚</p>

<h2 id="toc_27">äº”ã€Nginxé…ç½®æ–‡ä»¶ + æ³¨é‡Š</h2>

<pre><code class="language-conf"># Nginxçš„ç”¨æˆ·å’Œç»„
user www www;

# å·¥ä½œè¿›ç¨‹çš„æ•°ç›®
worker_processes auto;

# é”™è¯¯æ—¥å¿—å­˜æ”¾ä½ç½®ï¼Œæ ¼å¼ä¸ºï¼šerror_log æ–‡ä»¶è·¯å¾„ é”™è¯¯çº§åˆ«ï¼ˆdebug | info | notice | warn | error | crit | alert | emergï¼‰ï¼Œçº§åˆ«è¶Šé«˜è®°å½•çš„ä¿¡æ¯è¶Šå°‘
error_log /wwwlogs/error_nginx.log crit;

# è¿›ç¨‹æ ‡è¯†ç¬¦
pid /var/run/nginx.pid;

# è¿›ç¨‹å¯ä»¥æ‰“å¼€æœ€å¤§æè¿°ç¬¦çš„æ•°ç›®
worker_rlimit_nofile 51200;

events {
  # ä½¿ç”¨çš„I/Oæ¨¡å‹ï¼ˆepollã€kqueueã€selectã€poll etc.ï¼‰
  use epoll;

  # è‹¥è¯¥é¡¹è®¾ç½®ä¸ºoffï¼Œå½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ‰€æœ‰ä¼‘çœ çš„workerè¿›ç¨‹éƒ½ä¼šè¢«å”¤é†’ï¼Œæ¥äº‰å¤ºè¿™ä¸ªè¯·æ±‚ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¤„ç†è¯¥è¯·æ±‚ï¼Œå…¶ä»–æœªè·å¾—è¯·æ±‚çš„è¿›ç¨‹ç»§ç»­è¿›å…¥ä¼‘çœ ï¼Œè¿™å°±æ˜¯æƒŠç¾¤ç°è±¡ï¼Œä¼šé€ æˆæå¤§åœ°èµ„æºæµªè´¹
  # è¯¥é¡¹è®¾ç½®ä¸ºonåï¼ŒNginxè§„å®šåŒä¸€æ—¶åˆ»åªèƒ½æœ‰å”¯ä¸€ä¸€ä¸ªæŒæœ‰mutexé”çš„workerè¿›ç¨‹ä¼šæ¥å—å¹¶å¤„ç†è¯·æ±‚
  accept_mutex on;

  # workerè¿›ç¨‹çš„ç­‰å¾…æ—¶é—´ï¼Œè¿‡äº†ç­‰å¾…æ—¶é—´åï¼Œä¸‹ä¸€ä¸ªworkerè¿›ç¨‹å–å¾—mutexé”
  accept_mutex_delay 500ms;

  # æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œä¸å‰é¢çš„
  worker_connections 51200;

  # è®©workerè¿›ç¨‹å°½å¯èƒ½å¤šçš„æ¥å—è¯·æ±‚
  # è®¾ç½®ä¸ºonæ—¶ï¼Œè®©workerè¿›ç¨‹ä¸€æ¬¡æ€§åœ°æ¥å—ç›‘å¬é˜Ÿåˆ—é‡Œçš„æ‰€æœ‰è¯·æ±‚ï¼›è®¾ç½®ä¸ºoffåˆ™å¿…é¡»ä¸€ä¸ªä¸€ä¸ªåœ°æ¥å—ç›‘å¬é˜Ÿåˆ—é‡Œçš„è¯·æ±‚
  multi_accept on;
}

# httpæœåŠ¡å™¨
http {
  # åŒ…å«mime.typesæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºMIMEç±»å‹æ˜ å°„è¡¨ï¼ˆä¾‹å¦‚å›¾ç‰‡ã€æ–‡æœ¬ã€è§†é¢‘ç­‰ï¼‰
  # types {
  #  text/html                                        html htm shtml;
  #  text/css                                         css;
  #  text/xml                                         xml;
  #  image/gif                                        gif;
  #  image/jpeg                                       jpeg jpg;
  #  application/javascript                           js;
  #  application/atom+xml                             atom;
  #  application/rss+xml                              rss;
  #  ......
  # }
  include mime.types;

  # æŒ‡å®šé»˜è®¤MIMEç±»å‹ï¼ˆapplication/octet-streamä¸ºæ™®é€šçš„æ–‡ä»¶æµï¼Œæµè§ˆå™¨ä¼šæç¤ºç”¨æˆ·ä¸‹è½½ï¼‰
  default_type application/octet-stream;

  # ä¿å­˜æœåŠ¡å™¨åå­—çš„Hashè¡¨å¤§å°ï¼ˆè‹¥å¢åŠ å¤šä¸ªåŸŸååæ— æ³•å¯åŠ¨ï¼Œå¯èƒ½éœ€è¦å°†è¯¥é¡¹é€‚å½“è°ƒå¤§ï¼Œå¹¶ä¿æŒä¸ºå¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ï¼‰
  server_names_hash_bucket_size 128;
  # æœåŠ¡å™¨æœ€å¤§ä¸ªæ•°
  server_names_hash_max_size 512;

  # å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å­˜åŒºå¤§å°
  client_header_buffer_size 32k;
  # nginxé»˜è®¤ä½¿ç”¨client_header_buffer_sizeæ¥è¯»å–headerçš„å€¼ï¼Œè‹¥headerè¿‡å¤§ï¼Œåˆ™ä½¿ç”¨large_client_header_buffersæ¥è¯»å–
  large_client_header_buffers 4 32k;

  # å®¢æˆ·ç«¯è¯·æ±‚bodyçš„æœ€å¤§å€¼ï¼ˆnginxä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼‰
  client_max_body_size 1024m;
  # å®¢æˆ·ç«¯è¯·æ±‚bodyç¼“å†²åŒºå¤§å°
  client_body_buffer_size 10m;

  # sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚
  sendfile on;
  # å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨
  tcp_nopush on;

  # keep-aliveè¶…æ—¶æ—¶é—´
  keepalive_timeout 120;

  # å¼€å¯æˆ–å…³é—­nginxçš„ç‰ˆæœ¬ä¿¡æ¯ 
  server_tokens off;

  # æé«˜æ•°æ®çš„å®æ—¶å“åº”æ€§ï¼Œä»…åœ¨å°†è¿æ¥è½¬å˜ä¸ºé•¿è¿æ¥çš„æ—¶å€™æ‰è¢«å¯ç”¨ï¼ˆåœ¨upstreamå‘é€å“åº”åˆ°å®¢æˆ·ç«¯æ—¶ä¹Ÿä¼šå¯ç”¨ï¼‰
  tcp_nodelay on;

  # fastcgiç›¸å…³é…ç½®
  fastcgi_connect_timeout 300;
  fastcgi_send_timeout 300;
  fastcgi_read_timeout 300;
  fastcgi_buffer_size 64k;
  fastcgi_buffers 4 64k;
  fastcgi_busy_buffers_size 128k;
  fastcgi_temp_file_write_size 128k;
  fastcgi_intercept_errors on;

  # Gzipå‹ç¼©
  gzip on;
  # 16 8kä»£è¡¨ä»¥8kä¸ºå•ä½ï¼ŒæŒ‰ç…§åŸå§‹æ•°æ®å¤§å°ä»¥8kä¸ºå•ä½çš„16å€ç”³è¯·å†…å­˜
  gzip_buffers 16 8k;
  # å‹ç¼©çº§åˆ«ï¼Œç­‰çº§è¶Šé«˜ï¼Œæ¶ˆè€—CPUè¶Šå¤š
  gzip_comp_level 6;
  # è®¾ç½®æ”¯æŒhttpåè®®çš„æœ€å°å‹ç¼©ç‰ˆæœ¬
  gzip_http_version 1.1;
  # å…è®¸å‹ç¼©é¡µé¢çš„æœ€å°å­—èŠ‚æ•°
  gzip_min_length 256;
  # Nginxä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼Œå¼€å¯æˆ–è€…å…³é—­åç«¯æœåŠ¡å™¨è¿”å›çš„ç»“æœï¼ŒåŒ¹é…çš„å‰ææ˜¯åç«¯æœåŠ¡å™¨å¿…é¡»è¦è¿”å›åŒ…å«&quot;Via&quot;çš„ headerå¤´ã€‚
  # off - å…³é—­æ‰€æœ‰çš„ä»£ç†ç»“æœæ•°æ®çš„å‹ç¼©
  # expired - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« &quot;Expires&quot; å¤´ä¿¡æ¯
  # no-cache - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« &quot;Cache-Control:no-cache&quot; å¤´ä¿¡æ¯
  # no-store - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« &quot;Cache-Control:no-store&quot; å¤´ä¿¡æ¯
  # private - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« &quot;Cache-Control:private&quot; å¤´ä¿¡æ¯
  # no_last_modified - å¯ç”¨å‹ç¼©,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« &quot;Last-Modified&quot; å¤´ä¿¡æ¯
  # no_etag - å¯ç”¨å‹ç¼© ,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« &quot;ETag&quot; å¤´ä¿¡æ¯
  # auth - å¯ç”¨å‹ç¼© , å¦‚æœheaderå¤´ä¸­åŒ…å« &quot;Authorization&quot; å¤´ä¿¡æ¯
  # any - æ— æ¡ä»¶å¯ç”¨å‹ç¼©
  gzip_proxied any;
  # åœ¨httpå¤´æ–‡ä»¶ä¸­åŠ ä¸ªâ€œVary: Accept-Encodingâ€ï¼Œç»™ä»£ç†æœåŠ¡å™¨ç”¨çš„ï¼Œæœ‰çš„æµè§ˆå™¨æ”¯æŒå‹ç¼©ï¼Œæœ‰çš„ä¸æ”¯æŒæ‰€ä»¥é¿å…æµªè´¹ä¸æ”¯æŒçš„ä¹Ÿå‹ç¼©ï¼Œæ‰€ä»¥æ ¹æ®å®¢æˆ·ç«¯çš„HTTPå¤´æ¥åˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦å‹ç¼©
  gzip_vary on;
  # å‹ç¼©çš„MIMEç±»å‹
  gzip_types
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon;
  gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;

  #If you have a lot of static files to serve through Nginx then caching of the files&#39; metadata (not the actual files&#39; contents) can save some latency.
  open_file_cache max=1000 inactive=20s;
  open_file_cache_valid 30s;
  open_file_cache_min_uses 2;
  open_file_cache_errors on;

  # éšè—å¤´éƒ¨ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºï¼šproxy_hide_header å“åº”å¤´éƒ¨å­—æ®µ
  proxy_hide_header Vary;
  proxy_hide_header X-Powered-By;

######################## default ############################
   #http
   server {
    listen 80;
    # æœåŠ¡å™¨å
    server_name www.xxxx.com;
    
    # é‡å®šå‘
    rewrite ^(.*) https://www.xxxx.com;
    
    # è®¿é—®æ—¥å¿—
    access_log /www/LOG/access_nginx.log combined;

    # é»˜è®¤ä¸»é¡µ
    index index.html index.htm index.php;

    # é”™è¯¯é¡µé¢ï¼Œæ ¼å¼ï¼šerror_page é”™è¯¯ç  é”™è¯¯é¡µé¢è·¯å¾„
    #error_page 404 /404.html;
    #error_page 502 /502.html
    
    # http://www.xxxx.com/nginx_statusæŸ¥çœ‹nginxçŠ¶æ€
    location /nginx_status {
      stub_status on;
      access_log off;
      allow 127.0.0.1; # å…è®¸è®¿é—®çš„ip
      deny all;   # æ‹’ç»é™¤allowä¹‹å¤–çš„æ‰€æœ‰è®¿é—®
    }

    # è½¬å‘PHPè¯·æ±‚åˆ°php-fpmï¼Œ[^/]åŒ¹é…é/çš„å­—ç¬¦
    location ~ [^/]\.php(/|$) {
      fastcgi_pass 127.0.0.1:9000; # è½¬å‘åˆ°æœ¬åœ°9000ç«¯å£ï¼Œphp-fpmé»˜è®¤ç«¯å£
      #fastcgi_pass unix:/dev/shm/php-cgi.sock;
      fastcgi_index index.php;
      include fastcgi.conf;
    }
    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ {
      expires 30d; # è§„å®šæ—¶é—´åè¿‡æœŸ
      access_log off;
    }
    location ~ .*\.(js|css)?$ {
      expires 7d;
      access_log off;
    }
    location ~ /\.ht {
      deny all;
    }

  }

  #https 
  server{
    listen 443;
    server_name www.xxxx.com; 

    root  /www/website;
    index index.html index.htm index.php;
    access_log /www/LOG/access_nginx.log combined;

    # sslé…ç½®
    ssl on;
    ssl_certificate &quot;xxxx.crt&quot;;
    ssl_certificate_key &quot;xxxx.key&quot;;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;   

    location /nginx_status {
      stub_status on;
      access_log off;
      allow 127.0.0.1;
      deny all;
    }
    location ~ [^/]\.php(/|$) {
      #fastcgi_pass 127.0.0.1:9000;
      fastcgi_pass unix:/dev/shm/php-cgi.sock;
      fastcgi_index index.php;
      include fastcgi.conf;
    }
    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ {
      expires 30d;
      access_log off;
    } 
    location ~ .*\.(js|css)?$ {
      expires 7d;
      access_log off;
    } 
    location ~ /\.ht {
      deny all;
    } 
  }
########################## vhost #############################
  # åŒ…å«å…¶ä»–é…ç½®ä¿¡æ¯
  include vhost/*.conf;
}
</code></pre>

<p><em>Mission Complete!</em></p>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15408729897879.html" 
          title="Previous Post: Nodeç¯‡---ï¼ˆä¸€ï¼‰ç‰¹ç‚¹">&laquo; Nodeç¯‡---ï¼ˆä¸€ï¼‰ç‰¹ç‚¹</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15379545851364.html" 
          title="Next Post: Vue.jsçš„æ•°æ®ç»‘å®šåŸç†">Vue.jsçš„æ•°æ®ç»‘å®šåŸç† &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <script 
    src="https://utteranc.es/client.js"
    repo="AlanAlbert/personal-blog-comments"
    issue-term="pathname"     
    theme="github-light"
    crossorigin="anonymous"
    async>
</script>

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="https://tvax4.sinaimg.cn/crop.0.0.664.664.180/006k9NITly8fejxhyoc3aj30ig0igmy3.jpg?Expires=1562496252&ssig=LhZKVSOY7F&KID=imgbed,tva" /></div>
            
                <h1>Alançš„è¿›é˜¶æ—¥å¿—</h1>
                <div class="site-des">ä¸æœ‰è‚èƒ†äººå…±äº‹ï¼Œä»æ— å­—å¥å¤„è¯»ä¹¦ã€‚</div>
                <div class="social">


<a target="_blank" class="stackoverflow" href="https://stackoverflow.com/users/9723854/alan" title="StackOverflow"></a>




<a target="_blank" class="weibo" href="https://weibo.com/u/5794659803" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/Alan_Albert_" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/AlanAlbert" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:alan1766447919@gmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

               
             <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Important</h2>
                </div>
                <div class="side-content">
                  <div style="color:#ff0000; text-align:center; padding:8px;" class="bg-info site_notice">
                    â‘  å¯ä»¥ä½¿ç”¨GitHubè´¦å·ç™»å½•è¿›è¡Œè¯„è®ºå“¦ğŸ˜<br/><br/>â‘¡ æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå…¬ä¼—å·ï¼Œä¸€èµ·äº¤æµå­¦ä¹ ~<br/ ><img src="https://mp.weixin.qq.com/mp/qrcode?scene=10000005&size=102&__biz=MzIzNDU0NTc4OA==&mid=100000001&idx=1&sn=34f05b9196beb41e8561cbdfc5de26f5&send_time=1566403069" />
                  </div>
                </div>
            </div>
    

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="php.html"><strong>PHP</strong></a>
        
            <a href="interview.html"><strong>é¢è¯•</strong></a>
        
            <a href="security.html"><strong>å®‰å…¨</strong></a>
        
            <a href="linux.html"><strong>Linux</strong></a>
        
            <a href="mysql.html"><strong>MySQL</strong></a>
        
            <a href="redis.html"><strong>Redis</strong></a>
        
            <a href="data-struct-and-algorithm.html"><strong>æ•°æ®ç»“æ„åŠç®—æ³•</strong></a>
        
            <a href="computer-network.html"><strong>è®¡ç®—æœºç½‘ç»œ</strong></a>
        
            <a href="version-control-tool.html"><strong>ç‰ˆæœ¬æ§åˆ¶å·¥å…·</strong></a>
        
            <a href="read.html"><strong>è¯»ä¹¦</strong></a>
        
            <a href="javascript.html"><strong>JavaScript</strong></a>
        
            <a href="web-server.html"><strong>WebæœåŠ¡å™¨</strong></a>
        
            <a href="hackintosh.html"><strong>é»‘è‹¹æœ</strong></a>
        
            <a href="markdown.html"><strong>Markdown</strong></a>
        
            <a href="other.html"><strong>å…¶å®ƒ</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15810423370557.html">åˆæ¢Docker---ä½¿ç”¨Docker Composeç¼–æ’å®¹å™¨</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15714902755948.html">åˆæ¢Docker---ç¼–å†™Dockerfileæ­å»ºPHPå¼€å‘ç¯å¢ƒ</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15704551543845.html">åˆæ¢Docker---DockeråŠDockerfile</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15685386915043.html">ç™¾ä¸‡çº§æ•°æ®è¿ç§»ã€æ±‡æ€»</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15657597684450.html">PHPå®ç°å¼‚æ­¥å›è°ƒçš„æ€»ç»“</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  













<script src="asset/prism.js"></script>


<style type="text/css">
figure{margin: 0;padding: 0;}
figcaption{text-align:center;}

/* PrismJS 1.14.0
 http://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
    color: black;
    background: none;
    text-shadow: 0 1px white;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
    
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
    
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
    text-shadow: none;
    background:#b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
    text-shadow: none;
    background: #b3d4fc;
}

@media print {
    code[class*="language-"],
    pre[class*="language-"] {
        text-shadow: none;
    }
}

/* Code blocks */
pre[class*="language-"] {
    padding: 1em;
    margin: .5em 0;
    overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
    background: #F7F7F7;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em;
    border-radius: .3em;
    white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: slategray;
}

.token.punctuation {
    color: #999;
}

.namespace {
    opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
    color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
    color: #9a6e3a;
    background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
    color: #07a;
}

.token.function,
.token.class-name {
    color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
    color: #e90;
}

.token.important,
.token.bold {
    font-weight: bold;
}
.token.italic {
    font-style: italic;
}

.token.entity {
    cursor: help;
}


pre[class*="language-"].line-numbers {
    position: relative;
    padding-left: 3.8em;
    counter-reset: linenumber;
}

pre[class*="language-"].line-numbers > code {
    position: relative;
    white-space: inherit;
}

.line-numbers .line-numbers-rows {
    position: absolute;
    pointer-events: none;
    top: 0;
    font-size: 100%;
    left: -3.8em;
    width: 3em; /* works for line-numbers below 1000 lines */
    letter-spacing: -1px;
    border-right: 1px solid #999;

    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

}

    .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
    }

        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }

</style>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>



  </body>
</html>
